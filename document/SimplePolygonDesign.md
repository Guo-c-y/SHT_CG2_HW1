# 三类 simple polygon 的“锚点 + 受限随机”精简生成方案（非代码）

> 全局思路：先放置**少量锚点**，使其必然触发该类所需的“特殊情况”。再围绕锚点给出**允许区域**，在区域内**随机补点**并用**“插边不相交”**的增量规则构造边界顺序。仅保留每类**必需**的特殊性；其他形状特征不做限定。

## 0) 全局规则（适用于 A/B/C）
- 维度与网格：2D，整数坐标；`X,Y ∈ [0,100]`。
- 阈值：最小点距 `ε_point=1`；最小边长 `ε_len=1`；顶点到非相邻边距离 `ε_edge=1`。
- 简单性：除共享端点外，**非相邻**边不得相交或重叠。
- 方向：**不**统一为 CCW。保留生成的原始方向；记录 `signed_area` 符号供后续算法初始化使用。
- 随机种子：设全局 `SEED`，派生 `SEED_A/SEED_B/SEED_C`（或在全局种子上加偏移）。
- 构造与校验流水线  
  1) 依据每类规则**放置锚点**（保证该类必须的特殊性）。  
  2) 定义每条将被“可插入”的边的**允许插点区**（见各类描述）。  
  3) 在允许区内**随机补点**，并用“**不相交插入**”维持边界顺序：  
     - 在当前多边形的一条边 `(u,v)` 上，尝试把点 `p` 插入，使新边 `(u,p)` 与 `(p,v)` 与任何非相邻边**均不相交**，且满足阈值。  
     - 若失败，换一条可插边或重采样 `p`。  
  4) 校验：点距、边长、非相邻边相交、边缘距离。  
  5) 若为 A 类的“近退化”子情形：允许 `|signed_area|` 很小但**严格 > 0**。  
  6) 若多次失败，扩大允许区或减少补点数量后重试。

---

## A) 主题：**多重共线 + 近退化 + 近接触 + 误差敏感**
> 目标：外壳上出现**连续的共线顶点序列**；整体形状**几乎退化**（面积极小但>0）；存在**几乎接触**的近距离；包含**近共线**（orient 绝对值很小）以考验数值稳健性。  
> 非必需特征（如是否轴对齐、起点位置、方向）不做要求。

### A-1 锚点
- 选取四个**外框锚点** `A1..A4`，使其形成一个**严格凸**的粗框（任意外形，满足边不相交、边长≥1）。  
- 在外框的一条边 `(Ai, Ai+1)` 上预置**两到三个共线锚点** `C1..Ck`（k≥2），精确落在该边的整数格点上。  
- 设一对**近接触锚点**：选择一条非相邻边 `e`，在其附近放置顶点 `N`，使 `dist(N,e) ∈ [1,2]` 且不相交。  
- 近退化锚点：在外框某一侧插入两个点 `D1,D2`，将多边形的一段“收紧”为**极窄三角**（面积贡献极小但>0）。

### A-2 允许插点区（受限随机）
- **共线条带**：在 `(Ai, Ai+1)` 的线段上划定一个**离散格点子集**（去掉距离端点<1的点）作为“**共线插点区**”，用于随机补充更多**共线**点。  
- **近共线条带**：平移该边 1 个格距形成“平行窄带”，允许随机生成**近共线**点（orient 很小）。  
- **近接触区**：围绕 `e` 的法线方向在距离 `[1,2]` 内划定薄带，随机生成 1–2 个点，逐个尝试“插边不相交”。  
- 其他边的**普适插点区**：以边为中心的“安全菱形区域”（按 `ε_point, ε_edge` 裁切），随机少量补点。

### A-3 结果与校验
- 共线段上形成**多重共线序列**；  
- 全局面积**小但非零**；  
- 至少一处“**近接触**”记录其最小距离；  
- 若 orient 很小的三点出现，保持通过“插边不相交”与阈值检查即可。

---

## B) 主题：**检验 Melkman 的“弹出”机制**
> 目标：在扫描过程中，多次出现**尾端弹出**与**首端弹出**。即，序列中穿插若干**强凹顶点**，同时在序列前后两端都能引起凸壳更新。  
> 不强求共线、近接触或退化。

### B-1 锚点
- 选两个**远离**的端锚点 `S` 与 `T`（保证外壳跨度大）。  
- 在靠近 `S` 一侧布置一个**“口袋”锚组** `H1`：两点 `h1,h2` 在当前壳边之外形成**内凹入口**，再置一深点 `r1` 使得插入 `r1` 时会触发**首端弹出**。  
- 在靠近 `T` 一侧布置另一个**口袋**锚组 `H2`：两点 `h3,h4` + 深点 `r2`，构造**尾端弹出**。  
- 通过 5–7 个辅助锚点在 `S→…→T` 的路径上连成一个**简单**轮廓（不相交）。

### B-2 允许插点区（受限随机）
- **口袋扩展区**：在 `H1,H2` 的内凹三角扇区内随机补 1–3 点，使其在扫描顺序下**更深地侵入**已成壳体，增加弹出次数。  
- **中段平顺区**：在中间若干边的“安全菱形区域”内随机补 1–3 点，确保多边形保持简单但不影响“口袋”的主导效果。  
- 插入策略：优先向**将要被扫描到的端侧**插入点，确保既发生**首端**也发生**尾端**弹出。

### B-3 结果与校验
- 通过标注（或离线回放）可见至少一次**首端弹出**与**尾端弹出**；  
- 多边形始终简单，阈值满足。

---

## C) 主题：**“内部点无效 + 稀疏外扩”混合压力**
> 目标：构造长段顶点在**当前凸壳内部**（对 Melkman 是**no-op**），偶有**稀疏外扩点**把壳体推大。检验算法对**大量内部点**的跳过逻辑与少量外扩点的更新。  
> 不强求共线、窄缺口或近接触（这些已在 A/B 考过）。

### C-1 锚点
- 选取 5–6 个**外壳锚点** `O1..Ok`，形成一个**较大的粗壳**（不限定形状，只需简单）。  
- 在该壳体的**内部**选择 4–8 个**内部锚点** `I1..Im`，它们将被安插在边界序列的**长连续片段**中，保证在扫描到它们时大概率处于**当前凸壳内部**。  
- 安排 2–3 个**外扩锚点** `E1..E3`，位于当前壳外不同方向，插入它们时能**推大**壳体。

### C-2 允许插点区（受限随机）
- **内部走廊**：以外壳内若干边为基准，构造“内侧走廊”（距边 2–6 个格距），在走廊内随机补若干点，按边界顺序把这些点**成段**插入，使之在扫描前缀的壳内（no-op）。  
- **外扩扇区**：围绕 `E1..E3` 的方向建立“扇区允许区”，每个扇区补 1–2 个点，确保扫描到该段时会使壳**外扩**。  
- **顺序组织**：整体序列采用“**外壳锚段 → 大量内部段 → 外扩点 → 内部段 → 外扩点**”的**分段拼接**方法，每段插入时都做“不相交插入”检查。

### C-3 结果与校验
- 长段顶点在扫描时被判为**内部**而跳过；  
- 少量外扩点触发壳更新；  
- 多边形全程简单，阈值满足。

---

## 输出与复现
- 每类输出：  
  - **锚点清单**（坐标与语义，如“共线序列”“口袋顶点”“内部段”“外扩点”）；  
  - **允许区参数**（条带/扇区/走廊的中心线、宽度、数量范围）；  
  - **随机补点数量范围**与失败重采样上限；  
  - **生成顺序规划**（哪些边先允许插点，段与段的拼接顺序）；  
  - **校验日志**（是否发生重采样、最小距离、面积与方向符号）。  
- 随机性：在不限定总体轮廓的前提下，仅用“锚点 + 允许区”锁定**必要的特殊性**，其他形状自由产生。  
- 可复现：记录 `SEED_*` 与各类的随机参数（如条带宽度、扇区角度、走廊宽度、补点数）。

---
**备注**  
- A 类允许“近退化”，但为 simple polygon，面积必须**>0**。若需真退化（面积=0）作对照，应**单列**为“非 simple”测试集。  
- 三类互补：A=数值与几何边界，B=弹出逻辑压力，C=内部点跳过与稀疏外扩的混合压力。